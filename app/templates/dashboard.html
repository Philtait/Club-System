<!-- File: app/templates/dashboard.html -->
{% extends "base.html" %}
{% block title %}Dashboard | Club Management System{% endblock %}

{% block extra_head %}
<style>
  .dashboard-wrapper {
    background: #f8fafc;
    min-height: calc(100vh - 120px);
    padding: 40px 0;
  }

  .dashboard-header {
    background: white;
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #f1f5f9;
  }

  .dashboard-title {
    font-size: 2rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 8px;
  }

  .dashboard-subtitle {
    color: #64748b;
    font-size: 16px;
    margin: 0;
  }

  .user-avatar {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    font-weight: 600;
    margin-right: 20px;
    flex-shrink: 0;
  }

  .quick-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 20px;
  }

  .quick-action-btn {
    background: #f1f5f9;
    color: #475569;
    border: 1px solid #e2e8f0;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .quick-action-btn:hover {
    background: #e2e8f0;
    color: #334155;
    transform: translateY(-1px);
  }

  .quick-action-btn.primary {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
  }

  .quick-action-btn.primary:hover {
    background: #2563eb;
    color: white;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: white;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #f1f5f9;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--accent-color, #3b82f6);
  }

  .stat-card.primary::before { background: #3b82f6; }
  .stat-card.success::before { background: #10b981; }
  .stat-card.warning::before { background: #f59e0b; }
  .stat-card.info::before { background: #8b5cf6; }

  .stat-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
  }

  .stat-icon.primary { background: linear-gradient(135deg, #3b82f6, #2563eb); }
  .stat-icon.success { background: linear-gradient(135deg, #10b981, #059669); }
  .stat-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .stat-icon.info { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1e293b;
    line-height: 1;
    margin-bottom: 4px;
  }

  .stat-label {
    color: #64748b;
    font-size: 14px;
    font-weight: 500;
  }

  .stat-trend {
    font-size: 12px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 4px;
    margin-top: 8px;
  }

  .stat-trend.up { color: #10b981; }
  .stat-trend.down { color: #ef4444; }

  .content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 32px;
    margin-bottom: 32px;
  }

  .content-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #f1f5f9;
    overflow: hidden;
  }

  .content-card-header {
    padding: 24px 24px 0;
    border-bottom: 1px solid #f1f5f9;
    margin-bottom: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .content-card-title {
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    margin: 0;
  }

  .content-card-body {
    padding: 24px;
  }

  .club-item {
    display: flex;
    align-items: center;
    padding: 16px;
    border-radius: 12px;
    border: 1px solid #f1f5f9;
    margin-bottom: 12px;
    transition: all 0.2s ease;
    background: #fafbfc;
  }

  .club-item:hover {
    background: white;
    border-color: #e2e8f0;
    transform: translateY(-1px);
  }

  .club-logo {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    background: #f1f5f9;
    margin-right: 16px;
    flex-shrink: 0;
    object-fit: cover;
  }

  .club-info h5 {
    margin: 0 0 4px 0;
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
  }

  .club-info p {
    margin: 0;
    font-size: 14px;
    color: #64748b;
  }

  .club-actions {
    margin-left: auto;
    display: flex;
    gap: 8px;
  }

  .btn-small {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 6px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .btn-small.primary {
    background: #3b82f6;
    color: white;
    border: 1px solid #3b82f6;
  }

  .btn-small.primary:hover {
    background: #2563eb;
    color: white;
  }

  .btn-small.secondary {
    background: #f8fafc;
    color: #64748b;
    border: 1px solid #e2e8f0;
  }

  .btn-small.secondary:hover {
    background: #f1f5f9;
    color: #475569;
  }

  .event-item {
    display: flex;
    align-items: flex-start;
    padding: 16px;
    border-radius: 12px;
    border: 1px solid #f1f5f9;
    margin-bottom: 12px;
    background: #fafbfc;
    transition: all 0.2s ease;
  }

  .event-item:hover {
    background: white;
    border-color: #e2e8f0;
  }

  .event-date {
    background: #3b82f6;
    color: white;
    border-radius: 8px;
    padding: 8px 12px;
    text-align: center;
    margin-right: 16px;
    flex-shrink: 0;
    min-width: 60px;
  }

  .event-date-day {
    font-size: 18px;
    font-weight: 700;
    line-height: 1;
  }

  .event-date-month {
    font-size: 12px;
    opacity: 0.9;
  }

  .event-info {
    flex-grow: 1;
  }

  .event-info h5 {
    margin: 0 0 4px 0;
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
  }

  .event-info p {
    margin: 0;
    font-size: 14px;
    color: #64748b;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #f1f5f9;
  }

  .data-table thead {
    background: #f8fafc;
  }

  .data-table th {
    padding: 16px;
    text-align: left;
    font-weight: 600;
    color: #374151;
    font-size: 14px;
    border-bottom: 1px solid #e5e7eb;
  }

  .data-table td {
    padding: 16px;
    border-bottom: 1px solid #f1f5f9;
    color: #475569;
    font-size: 14px;
  }

  .data-table tbody tr:hover {
    background: #f8fafc;
  }

  .action-buttons {
    display: flex;
    gap: 8px;
  }

  .btn-action {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-action.approve {
    background: #10b981;
    color: white;
  }

  .btn-action.approve:hover {
    background: #059669;
  }

  .btn-action.reject {
    background: #ef4444;
    color: white;
  }

  .btn-action.reject:hover {
    background: #dc2626;
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #64748b;
  }

  .empty-state i {
    font-size: 3rem;
    color: #cbd5e1;
    margin-bottom: 16px;
  }

  .empty-state h4 {
    color: #475569;
    margin-bottom: 8px;
  }

  .empty-state p {
    margin: 0;
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .dashboard-wrapper {
      padding: 20px 0;
    }

    .dashboard-header {
      padding: 24px 20px;
      margin-bottom: 24px;
    }

    .dashboard-title {
      font-size: 1.5rem;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      font-size: 20px;
      margin-right: 16px;
    }

    .stats-grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .content-grid {
      grid-template-columns: 1fr;
      gap: 24px;
    }

    .stat-card {
      padding: 20px;
    }

    .content-card-body {
      padding: 20px;
    }

    .quick-actions {
      justify-content: center;
    }

    .club-item, .event-item {
      padding: 12px;
    }

    .data-table {
      font-size: 12px;
    }

    .data-table th,
    .data-table td {
      padding: 12px 8px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
  <div class="container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <div class="d-flex align-items-center">
        <div class="user-avatar">
          {{ current_user.first_name[0] }}{{ current_user.last_name[0] }}
        </div>
        <div class="flex-grow-1">
          <h1 class="dashboard-title">Welcome back, {{ current_user.first_name }}!</h1>
          <p class="dashboard-subtitle">
            {% if current_user.role == 'Student' %}
              Student Dashboard - Manage your clubs and events
            {% elif current_user.role == 'ClubLeader' %}
              Club Leader Dashboard - Manage your clubs and members
            {% elif current_user.role == 'Admin' %}
              Administrator Dashboard - System overview and management
            {% endif %}
          </p>
          <div class="quick-actions">
            {% if current_user.role == 'Student' %}
              <a href="{{ url_for('clubs.list_clubs') }}" class="quick-action-btn primary">
                <i class="fas fa-search"></i> Browse Clubs
              </a>
              <a href="{{ url_for('events.list_events') }}" class="quick-action-btn">
                <i class="fas fa-calendar"></i> View Events
              </a>
              <a href="{{ url_for('payments.history') }}" class="quick-action-btn">
                <i class="fas fa-credit-card"></i> Payment History
              </a>
            {% elif current_user.role == 'ClubLeader' %}
              <a href="{{ url_for('events.create_event') }}" class="quick-action-btn primary">
                <i class="fas fa-plus"></i> Create Event
              </a>
              <a href="{{ url_for('membership.club_members', club_id=current_user.club_leaderships[0].club_id) }}" class="quick-action-btn">
                <i class="fas fa-users"></i> Manage Members
              </a>
              <a href="{{ url_for('clubs.manage_leaders', club_id=current_user.club_leaderships[0].club_id) }}" class="quick-action-btn">
                <i class="fas fa-user-tie"></i> Manage Leaders
              </a>
            {% elif current_user.role == 'Admin' %}
              <a href="{{ url_for('clubs.create_club') }}" class="quick-action-btn primary">
                <i class="fas fa-plus"></i> Create Club
              </a>
              <a href="{{ url_for('admin.pending_clubs') }}" class="quick-action-btn">
                <i class="fas fa-hourglass-half"></i> Pending Clubs
              </a>
              <a href="{{ url_for('payments.admin_pending_payments') }}" class="quick-action-btn">
                <i class="fas fa-credit-card"></i> Pending Payments
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% if current_user.role == 'Student' and current_user.student %}
      <!-- Student Dashboard -->
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-header">
            <div class="stat-icon primary">
              <i class="fas fa-users"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.active_memberships }}</div>
          <div class="stat-label">Active Memberships</div>
        </div>
        <div class="stat-card success">
          <div class="stat-header">
            <div class="stat-icon success">
              <i class="fas fa-calendar-check"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.upcoming_registered }}</div>
          <div class="stat-label">Upcoming Events</div>
        </div>
        <div class="stat-card info">
          <div class="stat-header">
            <div class="stat-icon info">
              <i class="fas fa-history"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.past_events }}</div>
          <div class="stat-label">Past Events</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-header">
            <div class="stat-icon warning">
              <i class="fas fa-star"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.feedback_count }}</div>
          <div class="stat-label">Feedback Given</div>
        </div>
      </div>

      <div class="content-grid">
        <!-- My Clubs -->
        <div class="content-card">
          <div class="content-card-header">
            <h3 class="content-card-title">My Clubs</h3>
            <a href="{{ url_for('clubs.list_clubs') }}" class="btn-small primary">Browse More</a>
          </div>
          <div class="content-card-body">
            {% if memberships %}
              {% for m in memberships %}
              <div class="club-item">
                <img src="{{ url_for('static', filename=m.club.logo_url) }}" 
                     onerror="this.src='{{ url_for('static', filename='images/default-club.jpg') }}'"
                     alt="{{ m.club.name }}" class="club-logo">
                <div class="club-info">
                  <h5>{{ m.club.name }}</h5>
                  <p>Joined {{ m.joined_on.strftime('%b %d, %Y') }}</p>
                </div>
                <div class="club-actions">
                  <a href="{{ url_for('clubs.view_club', club_id=m.club.club_id) }}" class="btn-small primary">View</a>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="empty-state">
                <i class="fas fa-users"></i>
                <h4>No Clubs Yet</h4>
                <p>Join your first club to get started!</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Upcoming Events -->
        <div class="content-card">
          <div class="content-card-header">
            <h3 class="content-card-title">Upcoming Events</h3>
            <a href="{{ url_for('events.list_events') }}" class="btn-small secondary">View All</a>
          </div>
          <div class="content-card-body">
            {% if upcoming_events %}
              {% for ev in upcoming_events %}
              <div class="event-item">
                <div class="event-date">
                  <div class="event-date-day">{{ ev.event_date.strftime('%d') }}</div>
                  <div class="event-date-month">{{ ev.event_date.strftime('%b') }}</div>
                </div>
                <div class="event-info">
                  <h5>{{ ev.title }}</h5>
                  <p>{{ ev.club.name }} â€¢ {{ ev.event_date.strftime('%I:%M %p') }}</p>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="empty-state">
                <i class="fas fa-calendar"></i>
                <h4>No Upcoming Events</h4>
                <p>Check back later for new events!</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

    {% elif current_user.role == 'ClubLeader' and current_user.club_leaderships %}
      <!-- Club Leader Dashboard -->
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-header">
            <div class="stat-icon primary">
              <i class="fas fa-crown"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.clubs_led }}</div>
          <div class="stat-label">Clubs You Lead</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-header">
            <div class="stat-icon warning">
              <i class="fas fa-user-clock"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.pending_requests }}</div>
          <div class="stat-label">Pending Requests</div>
        </div>
      </div>

      <!-- Pending Membership Requests -->
      <div class="content-card mb-4">
        <div class="content-card-header">
          <h3 class="content-card-title">Pending Membership Requests</h3>
        </div>
        <div class="content-card-body">
          {% if pending_requests %}
            <table class="data-table">
              <thead>
                <tr>
                  <th>Student</th>
                  <th>School</th>
                  <th>Year</th>
                  <th>Requested</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for req in pending_requests %}
                <tr>
                  <td>{{ req.student.user.first_name }} {{ req.student.user.last_name }}</td>
                  <td>{{ req.student.school or 'N/A' }}</td>
                  <td>{{ req.student.year_of_study or 'N/A' }}</td>
                  <td>{{ req.joined_on.strftime('%b %d, %Y') }}</td>
                  <td>
                    <div class="action-buttons">
                      <form method="POST" action="{{ url_for('membership.approve_member', club_id=req.club_id, mid=req.membership_id) }}" style="display:inline;">
                       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                       <button class="btn-action approve">Approve</button>
                      </form>
                      <form method="POST" action="{{ url_for('membership.reject_member', club_id=req.club_id, mid=req.membership_id) }}" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                         <button class="btn-action reject">Reject</button>
                     </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="empty-state">
              <i class="fas fa-user-check"></i>
              <h4>No Pending Requests</h4>
              <p>All membership requests have been processed.</p>
            </div>
          {% endif %}
        </div>

        <!-- Upcoming Event Registrations -->
         <section class="content-card mb-5">
          <div class="content-card-header">
            <h3 class="content-card-title">Upcoming Event Registrations</h3>
          </div>
          <div class="content-card-body">
            {% if upcoming_regs %}
            <table class="data-table">
              <thead>
          <tr>
            <th>Event</th>
            <th>Date</th>
            <th>Registrant</th>
          </tr>
        </thead>
        <tbody>
          {% for reg in upcoming_regs %}
          <tr>
            <td>{{ reg.event.title }}</td>
            <td>{{ reg.event.event_date.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ reg.student.user.first_name }} {{ reg.student.user.last_name }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="empty-state">
        <i class="fas fa-calendar-check"></i>
        <h4>No Registrations Yet</h4>
        <p>No students have registered for upcoming events at this time.</p>
      </div>
    {% endif %}
  </div>
</section>


        

      </div>


    {% elif current_user.role == 'Admin' %}
      <!-- Admin Dashboard -->
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-header">
            <div class="stat-icon primary">
              <i class="fas fa-users"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.total_users }}</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card success">
          <div class="stat-header">
            <div class="stat-icon success">
              <i class="fas fa-flag"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.total_clubs }}</div>
          <div class="stat-label">Active Clubs</div>
        </div>
        <div class="stat-card info">
          <div class="stat-header">
            <div class="stat-icon info">
              <i class="fas fa-calendar-alt"></i>
            </div>
          </div>
          <div class="stat-number">{{ stats.total_events }}</div>
          <div class="stat-label">Total Events</div>
        </div>
      </div>

    {% else %}
      <!-- Fallback -->
      <div class="content-card">
        <div class="content-card-body">
          <div class="empty-state">
            <i class="fas fa-exclamation-triangle"></i>
            <h4>Dashboard Unavailable</h4>
            <p>Unable to load dashboard data. Please contact support if this persists.</p>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
